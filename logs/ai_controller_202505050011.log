2025-05-05 00:11:31.783 | INFO     | utils.logger:setup_logger:69 - 日志文件配置完成: logs/ai_controller_202505050011.log
2025-05-05 00:11:31.784 | INFO     | utils.logger:setup_logger:71 - 日志系统配置完成，级别: DEBUG
2025-05-05 00:11:31.784 | INFO     | __main__:main:200 - ==================================================
2025-05-05 00:11:31.784 | INFO     | __main__:main:201 - AI-UI-Controller 启动
2025-05-05 00:11:31.784 | INFO     | __main__:main:202 - 环境: dev
2025-05-05 00:11:31.784 | INFO     | __main__:main:203 - 任务: 建造一个制氧设备
2025-05-05 00:11:31.784 | INFO     | __main__:main:204 - 最大迭代次数: 20
2025-05-05 00:11:31.784 | INFO     | __main__:main:205 - 迭代延迟: 0.2秒
2025-05-05 00:11:31.784 | INFO     | __main__:main:206 - ==================================================
2025-05-05 00:11:31.784 | INFO     | base.agent:__init__:15 - Agent initialized with config
2025-05-05 00:11:31.784 | INFO     | core.ui_agent:__init__:27 - UI代理初始化完成，最大迭代次数=20，迭代延迟=0.2秒
2025-05-05 00:11:31.784 | INFO     | __main__:main:249 - 开始执行任务...
2025-05-05 00:11:31.784 | INFO     | core.ui_agent:setup:33 - 正在设置UI代理组件
2025-05-05 00:11:31.784 | DEBUG    | base.perception:__init__:14 - Perception module initialized
2025-05-05 00:11:31.784 | DEBUG    | core.screen_capture:__init__:26 - Screen capture initialized with min interval: 0.2s
2025-05-05 00:11:31.784 | DEBUG    | base.executor:__init__:14 - Executor module initialized
2025-05-05 00:11:31.784 | DEBUG    | core.input_controller:__init__:31 - Input controller initialized, move_duration=0.1, type_interval=0.1
2025-05-05 00:11:31.784 | DEBUG    | base.brain:__init__:14 - Brain module initialized
2025-05-05 00:11:31.784 | INFO     | core.llm_decision:__init__:41 - 使用自定义API端点: https://yunwu.ai/v1
2025-05-05 00:11:31.827 | DEBUG    | utils.prompt_manager:load_prompts:198 - 已加载指定提示词: default
2025-05-05 00:11:31.829 | DEBUG    | utils.prompt_manager:load_prompts:198 - 已加载指定提示词: browser
2025-05-05 00:11:31.829 | DEBUG    | utils.prompt_manager:load_prompts:198 - 已加载指定提示词: text_input
2025-05-05 00:11:31.829 | DEBUG    | utils.prompt_manager:load_prompts:198 - 已加载指定提示词: office
2025-05-05 00:11:31.830 | DEBUG    | utils.prompt_manager:load_prompts:210 - 从文件加载提示词: oxygen_not_included
2025-05-05 00:11:31.830 | INFO     | utils.prompt_manager:load_prompts:237 - 已加载5个提示词
2025-05-05 00:11:31.830 | INFO     | utils.prompt_manager:__init__:44 - 提示词管理器初始化完成，加载了5个提示词
2025-05-05 00:11:31.830 | INFO     | core.llm_decision:__init__:51 - 大模型决策模块初始化完成，使用模型: o4-mini
2025-05-05 00:11:31.831 | INFO     | core.llm_decision:__init__:52 - 已加载5个提示词
2025-05-05 00:11:31.831 | INFO     | core.ui_agent:setup:47 - UI代理组件初始化完成
2025-05-05 00:11:31.831 | INFO     | core.ui_agent:setup_middlewares:51 - 正在设置UI代理中间件
2025-05-05 00:11:31.831 | DEBUG    | base.middleware:__init__:96 - Middleware manager initialized
2025-05-05 00:11:31.833 | DEBUG    | base.middleware:__init__:14 - LoggingMiddleware middleware initialized
2025-05-05 00:11:31.833 | INFO     | middlewares.logging_mw:__init__:26 - 日志中间件初始化完成，日志级别: DEBUG
2025-05-05 00:11:31.833 | DEBUG    | base.middleware:add:111 - Added middleware: LoggingMiddleware
2025-05-05 00:11:31.833 | DEBUG    | base.middleware:__init__:14 - ThrottlingMiddleware middleware initialized
2025-05-05 00:11:31.833 | INFO     | middlewares.throttling:__init__:35 - 限流中间件初始化完成，默认延迟: 1.0秒
2025-05-05 00:11:31.833 | DEBUG    | base.middleware:add:111 - Added middleware: ThrottlingMiddleware
2025-05-05 00:11:31.833 | DEBUG    | base.middleware:__init__:14 - StateTrackingMiddleware middleware initialized
2025-05-05 00:11:31.833 | INFO     | middlewares.state_tracking:__init__:35 - 状态追踪中间件初始化完成，最大历史记录数: 10
2025-05-05 00:11:31.833 | DEBUG    | base.middleware:add:111 - Added middleware: StateTrackingMiddleware
2025-05-05 00:11:31.834 | DEBUG    | base.middleware:__init__:14 - ScreenshotLoggerMiddleware middleware initialized
2025-05-05 00:11:31.834 | DEBUG    | middlewares.screenshot_logger:_ensure_dirs:65 - 创建截图记录目录: logs/screenshots/20250505_001131
2025-05-05 00:11:31.834 | INFO     | middlewares.screenshot_logger:__init__:60 - 截图记录中间件初始化完成，记录目录: logs/screenshots/20250505_001131
2025-05-05 00:11:31.834 | DEBUG    | base.middleware:add:111 - Added middleware: ScreenshotLoggerMiddleware
2025-05-05 00:11:31.834 | INFO     | core.ui_agent:setup_middlewares:66 - UI代理中间件初始化完成
2025-05-05 00:11:31.834 | INFO     | core.ui_agent:run:87 - 开始执行UI代理任务: '建造一个制氧设备'
2025-05-05 00:11:31.834 | INFO     | core.ui_agent:run:88 - 使用提示词: oxygen_not_included
2025-05-05 00:11:31.834 | INFO     | core.ui_agent:run:104 - 迭代 1/20
2025-05-05 00:11:31.834 | DEBUG    | core.ui_agent:step:176 - 开始执行步骤
2025-05-05 00:11:31.834 | DEBUG    | middlewares.logging_mw:process_before_perception:56 - ===== 操作 #1 (迭代 1) 开始 =====
2025-05-05 00:11:31.834 | DEBUG    | core.ui_agent:step:183 - 正在捕获屏幕
2025-05-05 00:11:32.169 | DEBUG    | core.screen_capture:capture:50 - Screen captured: 2560x1440
2025-05-05 00:11:32.660 | DEBUG    | core.screen_capture:process:89 - Processed screen: 2560x1440, cursor at Point(x=1721, y=611)
2025-05-05 00:11:32.660 | DEBUG    | middlewares.logging_mw:process_after_perception:72 - 屏幕状态: 2560x1440, 鼠标位置: Point(x=1721, y=611)
2025-05-05 00:11:32.674 | DEBUG    | middlewares.screenshot_logger:process_after_perception:165 - 截图已保存: logs/screenshots/20250505_001131/step_0001_1746375092_before.png
2025-05-05 00:11:32.674 | DEBUG    | middlewares.logging_mw:process_before_decision:86 - 开始进行决策
2025-05-05 00:11:32.674 | DEBUG    | core.ui_agent:step:193 - 正在进行决策
2025-05-05 00:11:32.675 | DEBUG    | core.llm_decision:_call_api:247 - 正在发送请求到OpenAI API
2025-05-05 00:12:36.792 | DEBUG    | core.llm_decision:_call_api:261 - API响应已接收，耗时64.12秒
2025-05-05 00:12:36.794 | DEBUG    | core.llm_decision:_parse_response:297 - 已解析动作: [{'type': 'key', 'keys': ['space']}, {'type': 'move', 'x': 1060, 'y': 20}, {'type': 'click', 'button': 'left'}, {'type': 'move', 'x': 1060, 'y': 150}, {'type': 'click', 'button': 'left'}, {'type': 'key', 'keys': ['space']}]
2025-05-05 00:12:36.794 | INFO     | core.ui_agent:step:195 - 决策结果: [{'type': 'key', 'keys': ['space']}, {'type': 'move', 'x': 1060, 'y': 20}, {'type': 'click', 'button': 'left'}, {'type': 'move', 'x': 1060, 'y': 150}, {'type': 'click', 'button': 'left'}, {'type': 'key', 'keys': ['space']}]
2025-05-05 00:12:36.795 | INFO     | middlewares.logging_mw:process_after_decision:99 - 决策: 批量动作 (共 6 个)
2025-05-05 00:12:36.795 | INFO     | middlewares.logging_mw:process_after_decision:101 -   1. 按键 space
2025-05-05 00:12:36.795 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "key", "keys": ["space"]}
2025-05-05 00:12:36.795 | INFO     | middlewares.logging_mw:process_after_decision:101 -   2. 移动鼠标到 (1060, 20)
2025-05-05 00:12:36.796 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "move", "x": 1060, "y": 20}
2025-05-05 00:12:36.796 | INFO     | middlewares.logging_mw:process_after_decision:101 -   3. 点击鼠标 left 在 (0, 0)
2025-05-05 00:12:36.796 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "click", "button": "left"}
2025-05-05 00:12:36.796 | INFO     | middlewares.logging_mw:process_after_decision:101 -   4. 移动鼠标到 (1060, 150)
2025-05-05 00:12:36.796 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "move", "x": 1060, "y": 150}
2025-05-05 00:12:36.796 | INFO     | middlewares.logging_mw:process_after_decision:101 -   5. 点击鼠标 left 在 (0, 0)
2025-05-05 00:12:36.797 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "click", "button": "left"}
2025-05-05 00:12:36.797 | INFO     | middlewares.logging_mw:process_after_decision:101 -   6. 按键 space
2025-05-05 00:12:36.797 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "key", "keys": ["space"]}
2025-05-05 00:12:36.801 | DEBUG    | middlewares.screenshot_logger:_log_single_action:94 - 模型分析已保存: logs/screenshots/20250505_001131/step_0001_1746375092_analysis.txt
2025-05-05 00:12:36.803 | DEBUG    | middlewares.screenshot_logger:_log_single_action:129 - 动作已记录到日志: key
2025-05-05 00:12:36.803 | INFO     | middlewares.screenshot_logger:_log_single_action:136 - 模型分析: 第一步，当前屏幕状态分析：
2025-05-05 00:12:36.803 | INFO     | middlewares.screenshot_logger:_log_single_action:136 -          - 基地处于第1周期，3名复制人已登陆，食物充足（16,000 kcal），初始氧气（约1,457 g 可呼吸气体）仍在下降，无制氧设备。
2025-05-05 00:12:36.803 | INFO     | middlewares.screenshot_logger:_log_single_action:136 -          - 中央是打印舱与3名复制人，周围已挖出一小块空洞，下方有天然水源。
2025-05-05 00:12:36.803 | INFO     | middlewares.screenshot_logger:_log_single_action:136 -          - UI：左上显示周期与复制人状态，右上有“状态”“饮食”“优先级”“日程”“技能”“研究”“星图”按钮，右侧打开了当前选中元素的属性面板（此处是气体信息）。底部工具栏包含“基地”“氧气”“电力”“食...
2025-05-05 00:12:36.803 | INFO     | middlewares.screenshot_logger:_log_single_action:136 -          - 紧急状况：基地尚未搭建任何制氧设施，氧气量会持续降低，需尽快开启“氧气生产”研究并建造制氧设备。
2025-05-05 00:12:36.803 | INFO     | middlewares.screenshot_logger:_log_single_action:138 -          ... (更多分析内容已保存到文件)
2025-05-05 00:12:36.803 | DEBUG    | middlewares.logging_mw:process_before_execution:119 - 准备执行动作: key
2025-05-05 00:12:36.804 | DEBUG    | core.ui_agent:step:232 - 正在执行动作
2025-05-05 00:12:37.317 | DEBUG    | core.input_controller:_press_key:241 - Key pressed: space
2025-05-05 00:12:37.318 | INFO     | middlewares.logging_mw:_log_single_result:139 - 执行成功: key 动作
2025-05-05 00:12:37.318 | DEBUG    | middlewares.logging_mw:process_after_execution:155 - ===== 操作 #1 完成，总耗时: 65.48秒 =====
2025-05-05 00:12:37.318 | DEBUG    | middlewares.throttling:process_after_execution:116 - 动作执行耗时: 65.48秒
2025-05-05 00:12:37.319 | DEBUG    | middlewares.screenshot_logger:process_after_execution:224 - 执行结果已记录: logs/screenshots/20250505_001131/step_0001_1746375092_before_result.json
2025-05-05 00:12:37.319 | DEBUG    | core.ui_agent:step:256 - 步骤执行完成，耗时: 65.48秒
2025-05-05 00:12:37.620 | INFO     | core.ui_agent:run:104 - 迭代 2/20
2025-05-05 00:12:37.620 | DEBUG    | core.ui_agent:step:176 - 开始执行步骤
2025-05-05 00:12:37.620 | DEBUG    | middlewares.logging_mw:process_before_perception:56 - ===== 操作 #2 (迭代 2) 开始 =====
2025-05-05 00:12:37.621 | DEBUG    | core.ui_agent:step:183 - 正在捕获屏幕
2025-05-05 00:12:38.128 | DEBUG    | core.screen_capture:capture:50 - Screen captured: 2560x1440
2025-05-05 00:12:40.043 | DEBUG    | core.screen_capture:process:89 - Processed screen: 2560x1440, cursor at Point(x=1721, y=611)
2025-05-05 00:12:40.045 | DEBUG    | middlewares.logging_mw:process_after_perception:72 - 屏幕状态: 2560x1440, 鼠标位置: Point(x=1721, y=611)
2025-05-05 00:12:40.110 | DEBUG    | middlewares.screenshot_logger:process_after_perception:165 - 截图已保存: logs/screenshots/20250505_001131/step_0002_1746375160_before.png
2025-05-05 00:12:40.111 | DEBUG    | middlewares.logging_mw:process_before_decision:86 - 开始进行决策
2025-05-05 00:12:40.111 | DEBUG    | core.ui_agent:step:193 - 正在进行决策
2025-05-05 00:12:40.120 | DEBUG    | core.llm_decision:_call_api:247 - 正在发送请求到OpenAI API
2025-05-05 00:13:24.341 | DEBUG    | core.llm_decision:_call_api:261 - API响应已接收，耗时44.22秒
2025-05-05 00:13:24.343 | DEBUG    | core.llm_decision:_parse_response:297 - 已解析动作: [{'type': 'key', 'keys': ['space']}, {'type': 'key', 'keys': ['2']}, {'type': 'move', 'x': 380, 'y': 735}, {'type': 'click', 'button': 'left'}, {'type': 'move', 'x': 760, 'y': 370}, {'type': 'click', 'button': 'left'}, {'type': 'key', 'keys': ['space']}]
2025-05-05 00:13:24.343 | INFO     | core.ui_agent:step:195 - 决策结果: [{'type': 'key', 'keys': ['space']}, {'type': 'key', 'keys': ['2']}, {'type': 'move', 'x': 380, 'y': 735}, {'type': 'click', 'button': 'left'}, {'type': 'move', 'x': 760, 'y': 370}, {'type': 'click', 'button': 'left'}, {'type': 'key', 'keys': ['space']}]
2025-05-05 00:13:24.344 | INFO     | middlewares.logging_mw:process_after_decision:99 - 决策: 批量动作 (共 7 个)
2025-05-05 00:13:24.344 | INFO     | middlewares.logging_mw:process_after_decision:101 -   1. 按键 space
2025-05-05 00:13:24.344 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "key", "keys": ["space"]}
2025-05-05 00:13:24.344 | INFO     | middlewares.logging_mw:process_after_decision:101 -   2. 按键 2
2025-05-05 00:13:24.344 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "key", "keys": ["2"]}
2025-05-05 00:13:24.345 | INFO     | middlewares.logging_mw:process_after_decision:101 -   3. 移动鼠标到 (380, 735)
2025-05-05 00:13:24.345 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "move", "x": 380, "y": 735}
2025-05-05 00:13:24.345 | INFO     | middlewares.logging_mw:process_after_decision:101 -   4. 点击鼠标 left 在 (0, 0)
2025-05-05 00:13:24.346 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "click", "button": "left"}
2025-05-05 00:13:24.351 | INFO     | middlewares.logging_mw:process_after_decision:101 -   5. 移动鼠标到 (760, 370)
2025-05-05 00:13:24.352 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "move", "x": 760, "y": 370}
2025-05-05 00:13:24.352 | INFO     | middlewares.logging_mw:process_after_decision:101 -   6. 点击鼠标 left 在 (0, 0)
2025-05-05 00:13:24.352 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "click", "button": "left"}
2025-05-05 00:13:24.352 | INFO     | middlewares.logging_mw:process_after_decision:101 -   7. 按键 space
2025-05-05 00:13:24.352 | DEBUG    | middlewares.logging_mw:process_after_decision:103 -   动作详情: {"type": "key", "keys": ["space"]}
2025-05-05 00:13:24.354 | DEBUG    | middlewares.screenshot_logger:_log_single_action:94 - 模型分析已保存: logs/screenshots/20250505_001131/step_0002_1746375160_analysis.txt
2025-05-05 00:13:24.355 | DEBUG    | middlewares.screenshot_logger:_log_single_action:129 - 动作已记录到日志: key
2025-05-05 00:13:24.355 | INFO     | middlewares.screenshot_logger:_log_single_action:136 - 模型分析: 1. 屏幕内容与游戏状态分析
2025-05-05 00:13:24.355 | INFO     | middlewares.screenshot_logger:_log_single_action:136 -          - 周期：第1周期；复制人：3名；压力/应激：0%；食物储备：12,525千卡
2025-05-05 00:13:24.355 | INFO     | middlewares.screenshot_logger:_log_single_action:136 -          - 基地：仅有打印舱，周围被岩石包裹；下方有一片水体；目前无氧气生产建筑，复制人即将缺氧
2025-05-05 00:13:24.355 | INFO     | middlewares.screenshot_logger:_log_single_action:136 -          - 资源：附近可采的砂岩、铜矿、藻类等；无电源、无厕所
2025-05-05 00:13:24.355 | INFO     | middlewares.screenshot_logger:_log_single_action:136 -          - UI元素：左下为建造菜单（基地、氧气、电力等分类）；右侧弹出氧气信息；顶部有警告“未连接气体产生设备”“未连接厕所”
2025-05-05 00:13:24.355 | INFO     | middlewares.screenshot_logger:_log_single_action:138 -          ... (更多分析内容已保存到文件)
2025-05-05 00:13:24.356 | DEBUG    | middlewares.logging_mw:process_before_execution:119 - 准备执行动作: key
2025-05-05 00:13:24.356 | DEBUG    | core.ui_agent:step:232 - 正在执行动作
2025-05-05 00:13:24.692 | DEBUG    | core.input_controller:_press_key:241 - Key pressed: space
2025-05-05 00:13:24.693 | INFO     | middlewares.logging_mw:_log_single_result:139 - 执行成功: key 动作
2025-05-05 00:13:24.693 | DEBUG    | middlewares.logging_mw:process_after_execution:155 - ===== 操作 #2 完成，总耗时: 47.07秒 =====
2025-05-05 00:13:24.693 | DEBUG    | middlewares.throttling:process_after_execution:116 - 动作执行耗时: 47.07秒
2025-05-05 00:13:24.694 | DEBUG    | middlewares.screenshot_logger:process_after_execution:224 - 执行结果已记录: logs/screenshots/20250505_001131/step_0002_1746375160_before_result.json
2025-05-05 00:13:24.694 | DEBUG    | core.ui_agent:step:256 - 步骤执行完成，耗时: 47.07秒
2025-05-05 00:13:24.995 | INFO     | core.ui_agent:run:104 - 迭代 3/20
2025-05-05 00:13:24.996 | DEBUG    | core.ui_agent:step:176 - 开始执行步骤
2025-05-05 00:13:24.996 | DEBUG    | middlewares.logging_mw:process_before_perception:56 - ===== 操作 #3 (迭代 3) 开始 =====
2025-05-05 00:13:24.997 | DEBUG    | core.ui_agent:step:183 - 正在捕获屏幕
2025-05-05 00:13:25.515 | DEBUG    | core.screen_capture:capture:50 - Screen captured: 2560x1440
2025-05-05 00:13:27.504 | DEBUG    | core.screen_capture:process:89 - Processed screen: 2560x1440, cursor at Point(x=1721, y=611)
2025-05-05 00:13:27.505 | DEBUG    | middlewares.logging_mw:process_after_perception:72 - 屏幕状态: 2560x1440, 鼠标位置: Point(x=1721, y=611)
2025-05-05 00:13:27.557 | DEBUG    | middlewares.screenshot_logger:process_after_perception:165 - 截图已保存: logs/screenshots/20250505_001131/step_0003_1746375207_before.png
2025-05-05 00:13:27.558 | DEBUG    | middlewares.logging_mw:process_before_decision:86 - 开始进行决策
2025-05-05 00:13:27.558 | DEBUG    | core.ui_agent:step:193 - 正在进行决策
2025-05-05 00:13:27.560 | DEBUG    | core.llm_decision:_call_api:247 - 正在发送请求到OpenAI API
2025-05-05 00:13:35.752 | INFO     | core.ui_agent:run:124 - UI代理被用户中断
2025-05-05 00:13:35.754 | INFO     | core.ui_agent:stop:268 - UI代理已停止
2025-05-05 00:13:35.754 | INFO     | core.ui_agent:run:132 - UI代理在3次迭代后完成，用时123.92秒
2025-05-05 00:13:35.754 | INFO     | __main__:main:255 - ==================================================
2025-05-05 00:13:35.754 | INFO     | __main__:main:256 - 任务执行完成，总用时: 123.97秒
2025-05-05 00:13:35.754 | INFO     | __main__:main:257 - 总迭代次数: 3
2025-05-05 00:13:35.754 | INFO     | __main__:main:264 - 操作总数: 4, 成功: 4, 失败: 0
2025-05-05 00:13:35.754 | INFO     | __main__:main:266 - ==================================================
